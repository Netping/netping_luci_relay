<script type="text/javascript">
//<![CDATA[
 function button_action(btn) {
	var action = btn.getAttribute("data-action") || "0",
		relay = btn.getAttribute("data-relay") || "0",
		// для команды "rename" входное данное берём из <input type=text value>
		// для других команд - из <input type=button data-payload>
		payload = (action == "rename") ? btn.value : btn.getAttribute("data-payload") || "0";
		console.log(btn.attributes)
	var xhr = new XHR(false);
	var btn_spinner = document.getElementById("btn_enable_spinner");;
	spinner(btn_spinner, 1);
	btn.disabled = true;
	xhr.post('<%=luci.dispatcher.build_url("admin", "system", "relay", "action")%>/'+ '%h/%h'.format(action, relay), null,
	// xhr.post('<%=luci.dispatcher.build_url("admin", "system", "relay", "action")%>', null,
		function (x) {
			if (!x) {
				return;
			}
			btn.disabled = false;
			spinner(btn_spinner, 0);
			location.assign('<%=luci.dispatcher.build_url("admin", "system", "relay")%>');
	});
}

function spinner(element, state) {
	if (state === 1) {
		element.style.width = "16px";
		element.innerHTML = '<img src="<%=resource%>/icons/loading.gif" alt="<%:Loading%>" width="16" height="16" style="vertical-align:middle" />';
	}
	else {
		element.style.width = "0px";
		element.innerHTML = '';
	}
}

//]]>
</script>